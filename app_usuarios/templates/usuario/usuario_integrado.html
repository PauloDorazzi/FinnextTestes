<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMRP - Sistema de Solicitações</title>
    {% load static %}
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/usuario/usuario.css' %}"> 
</head>
<body>
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-university"></i>
            </div>
            <h2>FMRP Solicitações</h2>
        </div>
        
        <nav class="nav-menu">
            <ul>
                <li class="nav-item active" data-tab="new-request">
                    <i class="fas fa-plus-circle"></i>
                    <span>Nova Solicitação</span>
                </li>
                <li class="nav-item" data-tab="my-requests">
                    <i class="fas fa-history"></i>
                    <span>Minhas Solicitações</span>
                </li>
            </ul>
        </nav>

        <div class="user-profile" id="userProfile">
            <div class="user-avatar">JS</div>
            <div class="user-info">
                <div class="user-name">Carregando...</div>
                <div class="user-department">Departamento</div>
            </div>
            <i class="fas fa-chevron-down"></i>
            
            <div class="profile-dropdown" id="profileDropdown">
                <ul>
                    <li><i class="fas fa-user"></i> Meu Perfil</li>
                    <li><i class="fas fa-cog"></i> Configurações</li>
                    <li><i class="fas fa-sign-out-alt"></i> Sair</li>
                </ul>
            </div>
        </div>
    </aside>

    <div class="main-container">
        <main class="main-content">
            <header class="main-header">
                <div class="page-title">
                    <h1>Sistema de Solicitações</h1>
                </div>
            </header>
            
            <div class="tab-content active" id="new-request">
                <section class="content-section">
                    <div class="search-container">
                        <input type="text" class="search-input" id="productSearch" placeholder="Pesquisar equipamentos...">
                        <div class="catalog-options">
                            <button class="catalog-btn active" data-filter="all">Ver tudo</button>
                            <button class="catalog-btn" data-filter="Informática">Informática</button>
                            <button class="catalog-btn" data-filter="Móveis">Móveis</button>
                            <button class="catalog-btn" data-filter="Material Escolar">Material Escolar</button>
                            <button class="catalog-btn" data-filter="Equipamentos Médicos">Equipamentos Médicos</button>
                        </div>
                        <div class="catalog-grid" id="catalogResults">
                            <div class="catalog-item">Carregando produtos...</div>
                        </div>
                    </div>

                    <div class="cart">
                        <h3>Carrinho de Solicitação</h3>
                        <div id="cartItems">
                            <div class="cart-item">Carrinho vazio</div>
                        </div>
                        <button class="btn btn-primary" id="submitRequest" style="margin-top: 20px;">
                            <i class="fas fa-paper-plane"></i> Enviar Solicitação
                        </button>
                    </div>
                </section>
            </div>

            <div class="tab-content" id="my-requests">
                <section class="content-section">
                    <h2>Minhas Solicitações</h2>
                    <div class="requests-list" id="requestsList">
                        <div class="request-item">Carregando solicitações...</div>
                    </div>
                </section>
            </div>
        </main>

        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="{% static 'images/usuario/logo.png' %}" alt="FMRP-USP Logo" class="footer-logo-img">
                </div>
                <div class="footer-info">
                    <p>Faculdade de Medicina de Ribeirão Preto - Universidade de São Paulo</p>
                    <p>Sistema de Solicitações &copy; <span id="current-year"></span></p>
                </div>
                <div class="footer-links">
                    <a href="https://www.fmrp.usp.br/" target="_blank">Site Oficial</a>
                    <a href="https://sti.fmrp.usp.br/" target="_blank">STI FMRP</a>
                    <a href="#suporte">Suporte Técnico</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="{% static 'js/usuario/usuario_api.js' %}"></script>
    <script>
        // Carrinho global
        window.carrinho = [];

        // Funções do carrinho (adaptadas para trabalhar com a API)
        function adicionarAoCarrinho(produto) {
            const itemExistente = window.carrinho.find(item => item.id === produto.id);
            
            if (itemExistente) {
                itemExistente.quantidade += 1;
            } else {
                window.carrinho.push({
                    id: produto.id,
                    nome: produto.nome,
                    quantidade: 1
                });
            }
            
            atualizarCarrinho();
        }

        function atualizarCarrinho() {
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = '';
            
            if (window.carrinho.length === 0) {
                cartItems.innerHTML = '<div class="cart-item">Carrinho vazio</div>';
                return;
            }
            
            window.carrinho.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <span>${item.nome}</span>
                    <div class="quantity-control">
                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                        <span>${item.quantidade}</span>
                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                        <button class="remove-btn" data-id="${item.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            // Adicionar eventos aos botões
            document.querySelectorAll('.decrease').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    alterarQuantidade(id, -1);
                });
            });
            
            document.querySelectorAll('.increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    alterarQuantidade(id, 1);
                });
            });
            
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    removerDoCarrinho(id);
                });
            });
        }

        function alterarQuantidade(id, delta) {
            const item = window.carrinho.find(item => item.id === id);
            
            if (item) {
                item.quantidade += delta;
                
                if (item.quantidade <= 0) {
                    removerDoCarrinho(id);
                } else {
                    atualizarCarrinho();
                }
            }
        }

        function removerDoCarrinho(id) {
            window.carrinho = window.carrinho.filter(item => item.id !== id);
            atualizarCarrinho();
        }
    </script>
</body>
</html>
